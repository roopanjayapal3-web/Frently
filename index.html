<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRently - Professional Rental Service</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; color: #1e293b; margin:0; padding-bottom: 90px; }
        .page { display: none; min-height: 100vh; }
        .page.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .input-box { width: 100%; padding: 14px; border-radius: 12px; border: 1.5px solid #e2e8f0; margin-bottom: 12px; font-size: 14px; outline: none; transition: 0.3s; }
        .input-box:focus { border-color: #059669; box-shadow: 0 0 0 4px rgba(5, 150, 105, 0.1); }
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #f1f5f9; display: flex; justify-content: space-around; padding: 12px 0; z-index: 1000; box-shadow: 0 -10px 25px rgba(0,0,0,0.05); }
        .nav-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; color: #94a3b8; transition: 0.3s; }
        .nav-btn.active { color: #059669; }
        .nav-btn i { font-size: 20px; }
        .nav-btn span { font-[8px]; font-weight: 800; text-transform: uppercase; }
        .f-pill { flex: 0 0 auto; padding: 8px 16px; background: white; border: 1.5px solid #e2e8f0; border-radius: 12px; font-size: 11px; font-weight: 700; cursor: pointer; }
        .btn-primary { background: #059669; color: white; font-weight: 800; padding: 16px; border-radius: 16px; width: 100%; text-transform: uppercase; letter-spacing: 1px; }
    </style>
</head>
<body>

    <header class="p-4 bg-white sticky top-0 z-50 flex justify-between items-center border-b">
        <h1 class="text-2xl font-black italic text-emerald-600 tracking-tighter">FRently</h1>
        <div id="admin-indicator" class="hidden bg-red-600 text-white px-2 py-1 rounded text-[8px] font-black uppercase">Admin Live</div>
    </header>

    <div id="home" class="page active">
        <div id="hero-msg" class="p-4 text-center text-[10px] font-extrabold text-gray-400 uppercase tracking-widest leading-relaxed"></div>
        
        <div class="bg-white border-b p-3 flex gap-2 overflow-x-auto no-scrollbar">
            <select id="f-loc" onchange="applyFilters()" class="f-pill"><option value="">Location</option></select>
            <select id="f-bhk" onchange="applyFilters()" class="f-pill"><option value="">BHK</option><option>1BHK</option><option>2BHK</option><option>3BHK</option></select>
            <select id="f-mode" onchange="applyFilters()" class="f-pill"><option value="">Rent/Lease</option><option>Rent</option><option>Lease</option></select>
            <select id="f-eb" onchange="applyFilters()" class="f-pill"><option value="">EB</option><option>Separated</option><option>Shared</option></select>
            <select id="f-water" onchange="applyFilters()" class="f-pill"><option value="">Water</option><option>Metro</option><option>Bore</option></select>
        </div>

        <div id="house-grid" class="p-4 grid grid-cols-1 md:grid-cols-2 gap-6">
            </div>
    </div>

    <div id="owner" class="page p-4 bg-gray-50">
        <div class="max-w-xl mx-auto bg-white p-6 rounded-[32px] shadow-sm border">
            <h2 class="text-xl font-black mb-6 flex items-center gap-2"><i class="fas fa-home text-emerald-600"></i> List Your Property</h2>
            <form id="ownerForm">
                <p class="text-[10px] font-black text-gray-400 mb-2 uppercase">Private Details (Admin Only)</p>
                <input type="text" id="o-name" placeholder="Owner Full Name" class="input-box" required>
                <input type="tel" id="o-mob" placeholder="Owner Mobile Number" class="input-box" required>
                <textarea id="o-addr" placeholder="Property Full Address" class="input-box h-20" required></textarea>
                
                <hr class="my-6">
                <p class="text-[10px] font-black text-gray-400 mb-2 uppercase">Public Listing Details</p>
                <input type="text" id="o-loc" placeholder="Location City (eg: Chennai)" class="input-box" required>
                
                <div class="grid grid-cols-2 gap-3">
                    <select id="o-bhk" class="input-box"><option>1BHK</option><option>2BHK</option><option>3BHK</option></select>
                    <select id="o-mode" class="input-box"><option>Rent</option><option>Lease</option></select>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <select id="o-eb" class="input-box"><option value="Separated">Separated EB</option><option value="Shared">Shared EB</option></select>
                    <select id="o-water" class="input-box"><option value="Metro">Metro Water</option><option value="Bore">Bore Water</option></select>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <select id="o-type" class="input-box" onchange="toggleFloor(this.value)"><option>Separate House</option><option>Apartment</option></select>
                    <input type="number" id="o-floor" placeholder="Floor No" class="input-box" style="display:none">
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <select id="o-food" class="input-box"><option>Veg</option><option>Non-Veg</option></select>
                    <select id="o-pet" class="input-box"><option>Pet Allowed</option><option>Not Allowed</option></select>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <input type="text" id="o-size" placeholder="Home Size (sqft)" class="input-box">
                    <select id="o-toilet" class="input-box"><option>1 Toilet</option><option>2</option><option>3+</option></select>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <select id="o-park" class="input-box"><option>Bike Parking</option><option>Car Parking</option><option>Both</option></select>
                    <select id="o-phys" class="input-box"><option value="No">Physically Accessible: No</option><option value="Yes">Yes</option></select>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <input type="number" id="o-rent" placeholder="Rent + Maint" class="input-box" required>
                    <select id="o-adv" class="input-box"><option>3 Months Adv</option><option>4 Months</option><option>5 Months</option><option>5+</option></select>
                </div>

                <textarea id="o-cond" placeholder="Any Private Conditions?" class="input-box"></textarea>

                <div class="bg-emerald-50 p-4 rounded-2xl mb-6">
                    <p class="text-[10px] font-black text-emerald-700 uppercase mb-2">Upload 5 Images (Front, Hall, Bedroom, Kitchen, Toilet)</p>
                    <input type="file" id="o-imgs" multiple class="text-xs" required>
                </div>

                <button type="submit" id="o-btn" class="btn-primary">Submit to Admin</button>
            </form>
        </div>
    </div>

    <div id="partner" class="page p-4 bg-gray-50">
        <div class="max-w-xl mx-auto bg-white p-8 rounded-[32px] border">
            <h2 class="text-xl font-black mb-2">Partner Application</h2>
            <p class="text-[10px] text-red-600 font-bold mb-6 italic uppercase tracking-tighter">BGV check will be performed. Legal action for false data.</p>
            <form id="partnerForm">
                <input type="text" id="p-name" placeholder="Full Name (As per Aadhar)" class="input-box" required>
                <input type="text" id="p-fname" placeholder="Father's Name" class="input-box" required>
                <input type="number" id="p-aadhar" placeholder="Aadhar Number" class="input-box" required>
                <textarea id="p-addr" placeholder="Permanent Address" class="input-box" required></textarea>
                <input type="text" id="p-work" placeholder="Previous Work Info" class="input-box">
                <p class="text-[10px] font-black mb-2">Upload Selfie & ID Proof</p>
                <input type="file" id="p-docs" multiple class="text-xs mb-6" required>
                <button type="submit" id="p-btn" class="btn-primary bg-slate-900">Apply Now</button>
            </form>
        </div>
    </div>

    <div id="service" class="page p-6">
        <h2 class="text-xl font-black mb-8 italic">On-Demand Services</h2>
        <div class="grid grid-cols-2 gap-4">
            <div onclick="alert('Coming soon in your area!')" class="p-6 bg-white border rounded-3xl text-center"><i class="fas fa-faucet text-2xl text-emerald-600 mb-2"></i><p class="text-[10px] font-black">PLUMBING</p></div>
            <div onclick="alert('Coming soon in your area!')" class="p-6 bg-white border rounded-3xl text-center"><i class="fas fa-bolt text-2xl text-emerald-600 mb-2"></i><p class="text-[10px] font-black">ELECTRICAL</p></div>
            <div onclick="alert('Coming soon in your area!')" class="p-6 bg-white border rounded-3xl text-center"><i class="fas fa-paint-roller text-2xl text-emerald-600 mb-2"></i><p class="text-[10px] font-black">PAINTING</p></div>
            <div onclick="alert('Coming soon in your area!')" class="p-6 bg-white border rounded-3xl text-center"><i class="fas fa-broom text-2xl text-emerald-600 mb-2"></i><p class="text-[10px] font-black">CLEANING</p></div>
        </div>
    </div>

    <div id="help" class="page p-6">
        <div id="help-render" class="space-y-6">
            </div>
        <div class="mt-10 space-y-3">
            <button onclick="window.open('https://wa.me/916379548175')" class="btn-primary flex items-center justify-center gap-2"><i class="fab fa-whatsapp text-xl"></i> Chat with Us</button>
        </div>
        <p onclick="secretTap()" class="text-center text-[10px] text-gray-200 font-black mt-20 tracking-[10px] cursor-pointer italic">© FRENTLY 2026</p>
    </div>

    <div id="admin-panel" class="page p-4 bg-slate-50">
        <div class="flex justify-between items-center mb-6">
            <h2 class="font-black italic">CONTROL CENTER</h2>
            <button onclick="editGlobalContent()" class="bg-black text-white px-3 py-1 rounded-lg text-[9px] font-black">EDIT CONTENT</button>
        </div>
        <div id="admin-feed" class="space-y-4"></div>
    </div>

    <div id="booking-ui" class="page p-6 bg-white">
        <div class="max-w-md mx-auto py-10">
            <h2 class="text-2xl font-black mb-6">Confirm Visit</h2>
            <input type="hidden" id="target-house">
            <input type="text" id="b-name" placeholder="Your Name" class="input-box" required>
            <input type="tel" id="b-mob" placeholder="WhatsApp Number" class="input-box" required>
            <input type="text" id="b-loc" placeholder="Your Current Location" class="input-box" required>
            <button onclick="processBooking()" class="btn-primary mt-6">Send Request</button>
        </div>
    </div>

    <nav class="nav-bar">
        <button onclick="nav('home')" id="btn-home" class="nav-btn active"><i class="fas fa-th-large"></i><span>Home</span></button>
        <button onclick="nav('owner')" id="btn-owner" class="nav-btn"><i class="fas fa-plus-circle"></i><span>Owner</span></button>
        <button onclick="nav('partner')" id="btn-partner" class="nav-btn"><i class="fas fa-users"></i><span>Partner</span></button>
        <button onclick="nav('service')" id="btn-service" class="nav-btn"><i class="fas fa-tools"></i><span>Service</span></button>
        <button onclick="nav('help')" id="btn-help" class="nav-btn"><i class="fas fa-headset"></i><span>Help</span></button>
    </nav>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCE8ifaUi81vhonXR7XVhQgTzfwc0v3t8w",
            authDomain: "frently-online.firebaseapp.com",
            projectId: "frently-online",
            storageBucket: "frently-online.firebasestorage.app",
            messagingSenderId: "895745691340",
            appId: "1:895745691340:web:2300e54c79257124e77c69"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Cloudinary Config
        const CLOUD_NAME = "de3sxncm2";
        const UPLOAD_PRESET = "Frently-online";

        let tapCount = 0;
        let activeHouses = [];

        // --- Navigation ---
        function nav(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if(id !== 'admin-panel' && id !== 'booking-ui') {
                const btn = document.getElementById('btn-' + id);
                if(btn) btn.classList.add('active');
            }
            if(id === 'home') syncHome();
            if(id === 'help') syncSettings();
            window.scrollTo(0,0);
        }

        function toggleFloor(val) {
            document.getElementById('o-floor').style.display = (val === 'Apartment') ? 'block' : 'none';
        }

        // --- Data Sync ---
        function syncHome() {
            db.collection("listings").where("status", "==", "approved")
            .onSnapshot(snap => {
                activeHouses = [];
                let locs = new Set();
                snap.forEach(doc => {
                    const d = doc.data();
                    activeHouses.push(d);
                    locs.add(d.public_data.loc);
                });
                renderFeed(activeHouses);
                updateLocFilter(locs);
            });
            syncSettings();
        }

        function renderFeed(data) {
            const grid = document.getElementById('house-grid');
            grid.innerHTML = data.length ? '' : '<div class="col-span-full py-20 text-center opacity-20 font-black">Search Result Empty</div>';
            data.forEach(h => {
                const p = h.public_data;
                grid.innerHTML += `
                    <div class="bg-white rounded-[32px] overflow-hidden border shadow-sm p-4">
                        <img src="${p.images[0]}" class="w-full h-56 object-cover rounded-[24px] mb-4">
                        <div class="px-2">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-black text-lg text-emerald-800 italic uppercase">${p.loc}</h3>
                                <p class="font-black text-lg">₹${p.rent}</p>
                            </div>
                            <div class="flex flex-wrap gap-1 mb-4">
                                <span class="text-[9px] bg-gray-100 px-2 py-1 rounded font-bold uppercase">${p.bhk}</span>
                                <span class="text-[9px] bg-gray-100 px-2 py-1 rounded font-bold uppercase">${p.eb} EB</span>
                                <span class="text-[9px] bg-gray-100 px-2 py-1 rounded font-bold uppercase">${p.water}</span>
                                <span class="text-[9px] bg-gray-100 px-2 py-1 rounded font-bold uppercase">${p.mode}</span>
                            </div>
                            <button onclick="openBooking('${h.id}')" class="btn-primary py-3 text-[10px] shadow-lg shadow-emerald-100">Booking for Visit</button>
                        </div>
                    </div>`;
            });
        }

        // --- Filtering ---
        function applyFilters() {
            const loc = document.getElementById('f-loc').value;
            const bhk = document.getElementById('f-bhk').value;
            const mode = document.getElementById('f-mode').value;
            const eb = document.getElementById('f-eb').value;
            
            let filtered = activeHouses.filter(h => {
                const p = h.public_data;
                return (!loc || p.loc === loc) && 
                       (!bhk || p.bhk === bhk) && 
                       (!mode || p.mode === mode) &&
                       (!eb || p.eb === eb);
            });
            renderFeed(filtered);
        }

        function updateLocFilter(locs) {
            const sel = document.getElementById('f-loc');
            const current = sel.value;
            sel.innerHTML = '<option value="">Location</option>';
            locs.forEach(l => sel.innerHTML += `<option ${l===current?'selected':''}>${l}</option>`);
        }

        // --- Form Submissions ---
        document.getElementById('ownerForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('o-btn'); btn.innerText = "UPLOADING MEDIA..."; btn.disabled = true;
            try {
                const files = document.getElementById('o-imgs').files;
                if(files.length < 5) throw new Error("Please upload 5 photos");
                
                let imgs = [];
                for(let f of files) {
                    const fd = new FormData(); fd.append("file", f); fd.append("upload_preset", UPLOAD_PRESET);
                    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {method:"POST", body:fd});
                    const d = await res.json(); imgs.push(d.secure_url);
                }

                const onsId = "ONS-" + Math.floor(1000 + Math.random()*9000);
                const ownerData = {
                    id: onsId, status: 'pending', timestamp: Date.now(),
                    admin_data: { 
                        name: document.getElementById('o-name').value, 
                        mob: document.getElementById('o-mob').value,
                        addr: document.getElementById('o-addr').value,
                        cond: document.getElementById('o-cond').value
                    },
                    public_data: {
                        loc: document.getElementById('o-loc').value, rent: document.getElementById('o-rent').value,
                        bhk: document.getElementById('o-bhk').value, mode: document.getElementById('o-mode').value,
                        eb: document.getElementById('o-eb').value, water: document.getElementById('o-water').value,
                        type: document.getElementById('o-type').value, floor: document.getElementById('o-floor').value || '0',
                        food: document.getElementById('o-food').value, pet: document.getElementById('o-pet').value,
                        size: document.getElementById('o-size').value, toilet: document.getElementById('o-toilet').value,
                        park: document.getElementById('o-park').value, phys: document.getElementById('o-phys').value,
                        adv: document.getElementById('o-adv').value, images: imgs
                    }
                };
                await db.collection("listings").doc(onsId).set(ownerData);
                window.open(`https://wa.me/916379548175?text=New Listing ONS: ${onsId}\nName: ${ownerData.admin_data.name}\nLoc: ${ownerData.public_data.loc}`);
                alert("Property Submitted for Review!"); location.reload();
            } catch(e) { alert(e.message); btn.disabled = false; btn.innerText = "Submit Property"; }
        };

        document.getElementById('partnerForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('p-btn'); btn.innerText = "Processing...";
            const ptnId = "PTN-" + Math.floor(1000 + Math.random()*9000);
            const pData = {
                id: ptnId, type: 'partner',
                name: document.getElementById('p-name').value, mob: document.getElementById('p-aadhar').value,
                loc: document.getElementById('p-addr').value, work: document.getElementById('p-work').value
            };
            await db.collection("partners").doc(ptnId).set(pData);
            window.open(`https://wa.me/916379548175?text=Partner Application: ${ptnId}\nName: ${pData.name}\nLoc: ${pData.loc}`);
            alert("Application Sent Successfully!"); location.reload();
        };

        // --- Tenant Booking ---
        function openBooking(id) {
            document.getElementById('target-house').value = id;
            nav('booking-ui');
        }

        function processBooking() {
            const cmsId = "CMS-" + Math.floor(1000 + Math.random()*9000);
            const houseId = document.getElementById('target-house').value;
            const name = document.getElementById('b-name').value;
            const loc = document.getElementById('b-loc').value;
            const msg = `Booking for Visit: ${cmsId}\nHouse ID: ${houseId}\nCustomer: ${name}\nLocation: ${loc}`;
            window.open(`https://wa.me/916379548175?text=${encodeURIComponent(msg)}`);
            nav('home');
        }

        // --- Admin & Settings ---
        function secretTap() {
            tapCount++;
            if(tapCount === 7) {
                tapCount = 0;
                const user = prompt("User:");
                const pass = prompt("Pass:");
                if(user === "Sasineel1302" && pass === "Jaibhimbuddha1302") {
                    document.getElementById('admin-indicator').classList.remove('hidden');
                    nav('admin-panel'); syncAdmin();
                }
            }
        }

        function syncAdmin() {
            db.collection("listings").onSnapshot(snap => {
                const feed = document.getElementById('admin-feed');
                feed.innerHTML = '';
                snap.forEach(doc => {
                    const h = doc.data();
                    feed.innerHTML += `
                        <div class="bg-white p-4 rounded-2xl border shadow-sm">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-[10px] font-black bg-gray-100 px-2 py-1 rounded">${h.id}</span>
                                <span class="text-[10px] font-black uppercase ${h.status==='approved'?'text-emerald-600':'text-orange-500'}">${h.status}</span>
                            </div>
                            <p class="text-sm font-bold">${h.admin_data.name} (${h.admin_data.mob})</p>
                            <div class="flex gap-2 mt-4">
                                ${h.status === 'pending' ? `<button onclick="approveH('${h.id}')" class="bg-emerald-600 text-white px-4 py-2 rounded-lg text-[9px] font-black">APPROVE</button>` : ''}
                                <button onclick="deleteH('${h.id}')" class="bg-red-50 text-red-600 px-4 py-2 rounded-lg text-[9px] font-black">DELETE</button>
                            </div>
                        </div>`;
                });
            });
        }

        async function approveH(id) { await db.collection("listings").doc(id).update({status: 'approved'}); }
        async function deleteH(id) { if(confirm("Delete?")) await db.collection("listings").doc(id).delete(); }

        async function syncSettings() {
            const doc = await db.collection("settings").doc("main").get();
            const helpArea = document.getElementById('help-render');
            const heroArea = document.getElementById('hero-msg');
            
            if(doc.exists) {
                const d = doc.data();
                heroArea.innerText = d.hero || "Find Your Smart Home";
                helpArea.innerHTML = `
                    <div class="bg-white p-6 rounded-[30px] border">
                        <h3 class="font-black mb-3">Service Model</h3>
                        <p class="text-xs text-gray-500 leading-relaxed">${d.helpText || 'Loading...'}</p>
                    </div>`;
            } else {
                heroArea.innerText = "Smart Rental Service";
                helpArea.innerHTML = "No Help Content Found.";
            }
        }

        async function editGlobalContent() {
            const h = prompt("New Home Page Message:");
            const t = prompt("New Help/Subscription Content (Tamil/English):");
            if(h && t) {
                await db.collection("settings").doc("main").set({hero: h, helpText: t});
                alert("Content Updated!"); syncSettings();
            }
        }

        window.onload = syncHome;
    </script>
</body>
</html>
