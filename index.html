<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRently - Smart Rental Solution</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f9fafb; color: #1e293b; margin: 0; }
        .page { display: none; padding-bottom: 120px; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .input-f { width: 100%; padding: 12px; border-radius: 12px; border: 1.5px solid #e2e8f0; margin-bottom: 10px; font-size: 14px; outline: none; }
        .input-f:focus { border-color: #059669; box-shadow: 0 0 0 3px rgba(5,150,105,0.1); }
        .filter-chip { flex: 0 0 auto; padding: 6px 10px; background: white; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 9px; font-weight: 800; text-transform: uppercase; }
        .nav-fixed { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #f1f5f9; display: flex; justify-content: space-around; padding: 15px; z-index: 1000; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); }
        .btn-main { background: #059669; color: white; font-weight: 800; padding: 14px; border-radius: 15px; width: 100%; text-transform: uppercase; cursor: pointer; border: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <header class="p-4 bg-white sticky top-0 z-50 flex justify-between items-center border-b shadow-sm">
        <h1 class="text-2xl font-black italic text-emerald-600 tracking-tighter">FRently</h1>
        <div id="adm-indicator" class="hidden bg-red-600 text-white px-2 py-1 rounded text-[8px] font-black uppercase">Admin Mode Enabled</div>
    </header>

    <div id="home" class="page active">
        <div class="bg-white border-b p-3 space-y-2 overflow-x-auto flex gap-2 no-scrollbar">
            <select id="f-loc" onchange="filterData()" class="filter-chip"><option value="">Location</option></select>
            <select id="f-bhk" onchange="filterData()" class="filter-chip"><option value="">BHK</option><option>1BHK</option><option>2BHK</option><option>3BHK</option></select>
            <select id="f-type" onchange="filterData()" class="filter-chip"><option value="">Type</option><option>Apartment</option><option>Seperate House</option></select>
            <select id="f-eb" onchange="filterData()" class="filter-chip"><option value="">EB</option><option>Shared</option><option>Separated</option></select>
            <select id="f-water" onchange="filterData()" class="filter-chip"><option value="">Water</option><option>Metro</option><option>Bore</option></select>
            <select id="f-food" onchange="filterData()" class="filter-chip"><option value="">Food</option><option>Veg Only</option><option>Non-Veg</option></select>
            <select id="f-pet" onchange="filterData()" class="filter-chip"><option value="">Pet</option><option>Allowed</option><option>Not Allowed</option></select>
            <select id="f-phys" onchange="filterData()" class="filter-chip"><option value="">Physically Accessible</option><option>Yes</option><option>No</option></select>
        </div>
        <div id="main-grid" class="p-4 grid grid-cols-1 md:grid-cols-2 gap-6"></div>
    </div>

    <div id="owner" class="page p-4">
        <div class="max-w-xl mx-auto bg-white rounded-[30px] p-6 shadow-sm border">
            <h2 class="text-xl font-black italic mb-6">List Your Property</h2>
            <form id="ownerForm">
                <div class="grid grid-cols-1 gap-1">
                    <input type="text" id="o-name" placeholder="Full Name" class="input-f" required>
                    <input type="tel" id="o-mob" placeholder="Mobile Number" class="input-f" required>
                    <textarea id="o-addr" placeholder="Detailed Address" class="input-f h-20" required></textarea>
                    <input type="text" id="o-loc" placeholder="City/Location" class="input-f" required>
                </div>

                <div class="grid grid-cols-2 gap-2 mt-2">
                    <select id="o-bhk" class="input-f"><option>1BHK</option><option>2BHK</option><option>3BHK</option></select>
                    <select id="o-mode" class="input-f"><option>Rent</option><option>Lease</option></select>
                    <select id="o-type" class="input-f" onchange="document.getElementById('o-floor-box').style.display=(this.value=='Apartment'?'block':'none')">
                        <option>Seperate House</option><option>Apartment</option>
                    </select>
                    <div id="o-floor-box" style="display:none"><input type="number" id="o-floor" placeholder="Which Floor?" class="input-f"></div>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <select id="o-eb" class="input-f"><option>Separated EB</option><option>Shared EB</option></select>
                    <select id="o-water" class="input-f"><option>Metro Water</option><option>Bore Water</option></select>
                    <select id="o-food" class="input-f"><option>Veg Only</option><option>Non-Veg Allowed</option></select>
                    <select id="o-pet" class="input-f"><option>Pet Allowed</option><option>Not Allowed</option></select>
                    <select id="o-phys" class="input-f"><option value="No">Physically Accessible: No</option><option value="Yes">Yes</option></select>
                    <select id="o-park" class="input-f"><option>Bike Parking</option><option>Car Parking</option><option>Both</option></select>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <input type="text" id="o-size" placeholder="Home Size (sqft)" class="input-f">
                    <select id="o-toilet" class="input-f"><option>1 Toilet</option><option>2 Toilets</option><option>3 Toilets</option></select>
                    <select id="o-kids" class="input-f"><option value="No">Kids/Elderly Problem: No</option><option value="Yes">Yes</option></select>
                    <select id="o-terrace" class="input-f"><option value="Yes">Terrace Access: Yes</option><option value="No">No</option></select>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <select id="o-adv" class="input-f"><option>3 Months Advance</option><option>4 Months</option><option>5 Months</option><option>Above 5</option></select>
                    <select id="o-agr" class="input-f"><option value="Yes">Agreement: Yes</option><option value="No">No</option></select>
                </div>

                <input type="number" id="o-rent" placeholder="Rent + Maintenance Cost" class="input-f" required>
                <textarea id="o-cond" placeholder="Any special conditions for me? (Private)" class="input-f"></textarea>

                <p class="text-[10px] font-black mb-2 uppercase text-emerald-600">Upload 5 Photos (Front, Hall, Bedroom, Kitchen, Toilet)</p>
                <input type="file" id="o-imgs" multiple accept="image/*" class="text-xs font-bold mb-4" required>

                <button type="submit" id="o-btn" class="btn-main">Submit to Review</button>
            </form>
        </div>
    </div>

    <div id="partner" class="page p-4">
        <div class="max-w-xl mx-auto bg-white p-8 rounded-[30px] border">
            <h2 class="text-xl font-black italic mb-2">Partner Onboarding</h2>
            <p class="text-[10px] text-red-600 font-bold mb-6">இந்த நிறுவனத்தில் பணியில் இணைவதற்கு BGV செய்யப்படும். தவறான தகவல்கள் கொடுத்தால் சட்டப்படி நடவடிக்கை எடுக்கப்படும்.</p>
            <form id="partnerForm">
                <input type="text" id="p-name" placeholder="Full Name (As in Aadhar)" class="input-f" required>
                <input type="text" id="p-fname" placeholder="Father's Name" class="input-f" required>
                <input type="number" id="p-aadhar" placeholder="Aadhar Number" class="input-f" required>
                <textarea id="p-addr" placeholder="Permanent Address" class="input-f h-20" required></textarea>
                <input type="text" id="p-exp" placeholder="Previous Work Experience (Optional)" class="input-f">
                
                <p class="text-[10px] font-black mt-2">Upload Selfie & Aadhar/License Copy</p>
                <input type="file" id="p-imgs" multiple class="text-xs mb-6 mt-1" required>
                
                <button type="submit" id="p-btn" class="btn-main bg-black">Apply to Join</button>
            </form>
        </div>
    </div>

    <div id="service" class="page p-6 text-center">
        <h2 class="text-2xl font-black italic mb-10">Our Premium Services</h2>
        <div class="grid grid-cols-2 gap-4">
            <div class="p-6 bg-white rounded-3xl border shadow-sm"><i class="fas fa-faucet text-emerald-600 text-xl mb-2"></i><p class="text-[10px] font-black uppercase">Plumbing</p></div>
            <div class="p-6 bg-white rounded-3xl border shadow-sm"><i class="fas fa-bolt text-emerald-600 text-xl mb-2"></i><p class="text-[10px] font-black uppercase">Electrical</p></div>
            <div class="p-6 bg-white rounded-3xl border shadow-sm"><i class="fas fa-paint-roller text-emerald-600 text-xl mb-2"></i><p class="text-[10px] font-black uppercase">Painting</p></div>
            <div class="p-6 bg-white rounded-3xl border shadow-sm"><i class="fas fa-broom text-emerald-600 text-xl mb-2"></i><p class="text-[10px] font-black uppercase">House Keeping</p></div>
        </div>
        <button onclick="alert('Coming soon in your area!')" class="btn-main mt-10">Get Estimate</button>
    </div>

    <div id="help" class="page p-4">
        <div class="max-w-md mx-auto space-y-4">
            <div class="bg-white p-6 rounded-[30px] border text-center">
                <h3 class="font-black mb-4">Subscription Model</h3>
                <div class="text-left space-y-4 text-xs">
                    <p><strong>Owners:</strong> No subscription fee. நம்ம பிசினஸ் மாடல் ஓனர் மற்றும் டென்னென்ட் இடையே ஒரு நல்ல பாலமாக இருப்பதே. (Owners, it's 100% free for you.)</p>
                    <p class="text-emerald-700"><strong>Tenants:</strong> இந்த சேவைக்கு ₹999/- Subscription வாங்கப்படும். இதை டென்னென்ட் விசிட்டிற்கு பிறகு கொடுத்தால் போதும். (Fee applicable only after visit.)</p>
                </div>
            </div>
            <button onclick="window.open('https://wa.me/916379548175')" class="btn-main bg-black"><i class="fab fa-whatsapp mr-2"></i>Chat with Us</button>
            <p onclick="hTap()" class="text-center text-[10px] text-gray-300 font-bold tracking-[6px] pt-32">© FRENTLY 2026</p>
        </div>
    </div>

    <div id="book-page" class="page p-6">
        <div class="bg-white p-8 rounded-[40px] shadow-2xl border">
            <h2 class="text-xl font-black italic mb-6">Book Visit</h2>
            <input type="hidden" id="b-id">
            <input type="text" id="b-name" placeholder="Your Name" class="input-f">
            <input type="tel" id="b-mob" placeholder="WhatsApp Number" class="input-f">
            <input type="text" id="b-loc" placeholder="Your Area" class="input-f">
            <button onclick="confirmBooking()" class="btn-main mt-4">Confirm & Send Message</button>
        </div>
    </div>

    <div id="adm-panel" class="page p-4">
        <h2 class="text-xl font-black mb-6 italic uppercase">Verification Center</h2>
        <div id="adm-list" class="space-y-4"></div>
    </div>

    <nav class="nav-fixed">
        <button onclick="showP('home')" id="n-home" class="text-emerald-600"><i class="fas fa-home"></i><span class="block text-[8px] font-black">HOME</span></button>
        <button onclick="showP('owner')" id="n-owner" class="text-gray-400"><i class="fas fa-key"></i><span class="block text-[8px] font-black">OWNER</span></button>
        <button onclick="showP('partner')" id="n-partner" class="text-gray-400"><i class="fas fa-handshake"></i><span class="block text-[8px] font-black">PARTNER</span></button>
        <button onclick="showP('service')" id="n-service" class="text-gray-400"><i class="fas fa-tools"></i><span class="block text-[8px] font-black">SERVICE</span></button>
        <button onclick="showP('help')" id="n-help" class="text-gray-400"><i class="fas fa-headset"></i><span class="block text-[8px] font-black">HELP</span></button>
    </nav>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCE8ifaUi81vhonXR7XVhQgTzfwc0v3t8w",
            authDomain: "frently-online.firebaseapp.com",
            projectId: "frently-online",
            storageBucket: "frently-online.firebasestorage.app",
            messagingSenderId: "895745691340",
            appId: "1:895745691340:web:2300e54c79257124e77c69"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const CLOUD_NAME = "de3sxncm2";
        const PRESET = "Frently-online";

        let tap = 0;
        let allHouses = [];

        function showP(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('nav button').forEach(b => b.classList.replace('text-emerald-600', 'text-gray-400'));
            if(id !== 'adm-panel' && id !== 'book-page') document.getElementById('n-' + id).classList.replace('text-gray-400', 'text-emerald-600');
            if(id === 'home') fetchHome();
        }

        function hTap() {
            tap++;
            if(tap === 7) {
                tap = 0;
                const u = prompt("User:");
                const p = prompt("Pass:");
                if(u === "Sasineel1302" && p === "Jaibhimbuddha1302") {
                    document.getElementById('adm-indicator').classList.remove('hidden');
                    showP('adm-panel');
                    renderAdmin();
                }
            }
        }

        async function fetchHome() {
            const grid = document.getElementById('main-grid');
            const snap = await db.collection("listings").get();
            allHouses = [];
            let locs = new Set();
            snap.forEach(doc => {
                const d = doc.data();
                if(d.status === 'approved') {
                    allHouses.push(d);
                    locs.add(d.public_data.loc);
                }
            });

            const locS = document.getElementById('f-loc');
            locS.innerHTML = '<option value="">Location</option>';
            locs.forEach(l => locS.innerHTML += `<option>${l}</option>`);
            renderHouses(allHouses);
        }

        function renderHouses(arr) {
            const grid = document.getElementById('main-grid');
            grid.innerHTML = arr.length ? '' : '<p class="text-center py-20 opacity-30 font-black">Scanning for homes...</p>';
            arr.forEach(h => {
                const d = h.public_data;
                grid.innerHTML += `
                    <div class="bg-white rounded-[40px] overflow-hidden border shadow-sm p-4 relative">
                        <img src="${d.images[0]}" class="w-full h-52 object-cover rounded-[30px] mb-4 shadow-md">
                        <div class="px-2">
                            <div class="flex justify-between items-center mb-1">
                                <h3 class="font-black text-sm uppercase italic">${d.loc}</h3>
                                <span class="bg-emerald-100 text-emerald-700 text-[8px] font-black px-2 py-1 rounded-full uppercase">${d.mode}</span>
                            </div>
                            <p class="text-xl font-black text-emerald-600 mb-1">₹${d.rent}</p>
                            <p class="text-[9px] text-gray-400 font-bold uppercase tracking-tight">${d.bhk} | ${d.type} | ${d.water} | ${d.eb}</p>
                            <div class="grid grid-cols-2 gap-2 mt-4">
                                <div class="text-[8px] font-bold text-gray-500 uppercase"><i class="fas fa-dog mr-1"></i> ${d.pet}</div>
                                <div class="text-[8px] font-bold text-gray-500 uppercase"><i class="fas fa-utensils mr-1"></i> ${d.food}</div>
                            </div>
                            <button onclick="openBooking('${h.id}')" class="btn-main mt-4 py-3 text-[10px] shadow-lg">Book Visit</button>
                        </div>
                    </div>`;
            });
        }

        function openBooking(id) {
            document.getElementById('b-id').value = id;
            showP('book-page');
        }

        function confirmBooking() {
            const id = document.getElementById('b-id').value;
            const name = document.getElementById('b-name').value;
            const mob = document.getElementById('b-mob').value;
            const loc = document.getElementById('b-loc').value;
            const uid = "CMS-" + Math.floor(Math.random()*9000 + 1000);
            
            const msg = `Rental Visit Booking!\n\nID: ${uid}\nHouse ID: ${id}\nName: ${name}\nMobile: ${mob}\nLocation: ${loc}`;
            window.open(`https://wa.me/916379548175?text=${encodeURIComponent(msg)}`);
            showP('home');
        }

        document.getElementById('ownerForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('o-btn');
            btn.innerText = "UPLOADING DATA...";
            btn.disabled = true;

            const files = document.getElementById('o-imgs').files;
            let imgs = [];
            for(let f of files) {
                const fd = new FormData();
                fd.append("file", f); fd.append("upload_preset", PRESET);
                const r = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {method:"POST", body:fd});
                const d = await r.json(); imgs.push(d.secure_url);
            }

            const onsId = "ONS-" + Math.floor(Math.random()*9000 + 1000);
            const data = {
                id: onsId, status: 'pending',
                admin_data: { name: document.getElementById('o-name').value, mob: document.getElementById('o-mob').value, addr: document.getElementById('o-addr').value, cond: document.getElementById('o-cond').value },
                public_data: {
                    loc: document.getElementById('o-loc').value, rent: document.getElementById('o-rent').value, bhk: document.getElementById('o-bhk').value, type: document.getElementById('o-type').value,
                    floor: document.getElementById('o-floor').value, eb: document.getElementById('o-eb').value, water: document.getElementById('o-water').value, food: document.getElementById('o-food').value,
                    pet: document.getElementById('o-pet').value, phys: document.getElementById('o-phys').value, park: document.getElementById('o-park').value, size: document.getElementById('o-size').value,
                    toilet: document.getElementById('o-toilet').value, kids: document.getElementById('o-kids').value, terrace: document.getElementById('o-terrace').value, adv: document.getElementById('o-adv').value,
                    agr: document.getElementById('o-agr').value, mode: document.getElementById('o-mode').value, images: imgs
                }
            };

            await db.collection("listings").doc(onsId).set(data);
            const wMsg = `New Home Listed (Pending Approval)!\n\nID: ${onsId}\nOwner: ${data.admin_data.name}\nLocation: ${data.public_data.loc}\nMobile: ${data.admin_data.mob}`;
            window.open(`https://wa.me/916379548175?text=${encodeURIComponent(wMsg)}`);
            alert("Listing sent successfully!"); location.reload();
        };

        document.getElementById('partnerForm').onsubmit = async (e) => {
            e.preventDefault();
            const pBtn = document.getElementById('p-btn');
            pBtn.innerText = "Processing...";
            
            const ptnId = "PTN-" + Math.floor(Math.random()*9000 + 1000);
            const pData = {
                id: ptnId, name: document.getElementById('p-name').value, aadhar: document.getElementById('p-aadhar').value,
                loc: document.getElementById('p-addr').value, exp: document.getElementById('p-exp').value
            };
            
            await db.collection("partners").doc(ptnId).set(pData);
            const wMsg = `New Partner Application!\n\nID: ${ptnId}\nName: ${pData.name}\nLocation: ${pData.loc}`;
            window.open(`https://wa.me/916379548175?text=${encodeURIComponent(wMsg)}`);
            alert("Application Submitted!"); location.reload();
        };

        async function renderAdmin() {
            const list = document.getElementById('adm-list');
            const snap = await db.collection("listings").get();
            list.innerHTML = '';
            snap.forEach(doc => {
                const h = doc.data();
                list.innerHTML += `
                    <div class="bg-white p-5 rounded-[30px] border shadow-sm">
                        <p class="font-black text-[10px] uppercase text-emerald-600 mb-1">${h.id} — ${h.status}</p>
                        <h4 class="font-black text-sm mb-1">${h.admin_data.name}</h4>
                        <p class="text-[9px] font-bold text-gray-400 mb-4">${h.admin_data.mob} | ${h.public_data.loc}</p>
                        <div class="flex gap-2">
                            <button onclick="approve('${h.id}')" class="bg-emerald-600 text-white px-4 py-2 rounded-xl text-[10px] font-black uppercase">Approve</button>
                            <button onclick="deleteListing('${h.id}')" class="bg-red-50 text-red-600 px-4 py-2 rounded-xl text-[10px] font-black uppercase">Delete</button>
                        </div>
                    </div>`;
            });
        }

        async function approve(id) {
            await db.collection("listings").doc(id).update({status: 'approved'});
            alert("Live Now!"); renderAdmin();
        }

        async function deleteListing(id) {
            if(confirm("Confirm Delete?")) {
                await db.collection("listings").doc(id).delete();
                renderAdmin();
            }
        }

        window.onload = fetchHome;
    </script>
</body>
</html>
