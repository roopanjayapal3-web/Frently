<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRently - Smart Rental Solution</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; color: #1e293b; }
        .page { display: none; padding-bottom: 100px; animation: fadeIn 0.3s ease-in-out; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .input-f { width: 100%; padding: 12px; border-radius: 12px; border: 1.5px solid #e2e8f0; margin-bottom: 10px; font-size: 14px; outline: none; transition: 0.2s; }
        .input-f:focus { border-color: #059669; box-shadow: 0 0 0 3px rgba(5,150,105,0.1); }
        .filter-chip { flex: 0 0 auto; padding: 6px 12px; background: white; border: 1px solid #e2e8f0; border-radius: 50px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        .nav-fixed { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #f1f5f9; display: flex; justify-content: space-around; padding: 12px; z-index: 1000; box-shadow: 0 -5px 15px rgba(0,0,0,0.03); }
    </style>
</head>
<body>

    <header class="p-4 bg-white sticky top-0 z-50 flex justify-between items-center border-b">
        <div>
            <h1 class="text-2xl font-black italic text-emerald-600 tracking-tighter">FRently</h1>
        </div>
        <div id="adm-badge" class="hidden bg-red-600 text-white px-3 py-1 rounded-full text-[8px] font-black uppercase">Admin Mode</div>
    </header>

    <div id="home" class="page active">
        <div class="bg-white border-b p-4 space-y-3 overflow-x-auto">
            <div class="flex gap-2 pb-2">
                <select id="f-loc" onchange="filterData()" class="filter-chip"><option value="">Location</option></select>
                <select id="f-bhk" onchange="filterData()" class="filter-chip"><option value="">BHK</option><option>1BHK</option><option>2BHK</option><option>3BHK</option></select>
                <select id="f-eb" onchange="filterData()" class="filter-chip"><option value="">EB</option><option>Shared</option><option>Separated</option></select>
                <select id="f-water" onchange="filterData()" class="filter-chip"><option value="">Water</option><option>Metro</option><option>Bore</option></select>
                <select id="f-food" onchange="filterData()" class="filter-chip"><option value="">Food</option><option>Veg</option><option>Non-Veg</option></select>
                <select id="f-pet" onchange="filterData()" class="filter-chip"><option value="">Pet</option><option>Allowed</option><option>Not Allowed</option></select>
                <select id="f-mode" onchange="filterData()" class="filter-chip"><option value="">Rent/Lease</option><option>Rent</option><option>Lease</option></select>
            </div>
        </div>
        <div id="main-grid" class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    </div>

    <div id="owner" class="page p-4">
        <div class="max-w-xl mx-auto bg-white rounded-3xl p-6 shadow-sm border">
            <h2 class="text-xl font-black italic mb-6">List Your Property</h2>
            <form id="ownerForm">
                <div class="p-4 bg-gray-50 rounded-2xl mb-4 space-y-2 border-dashed border-2">
                    <p class="text-[9px] font-bold text-gray-400 uppercase">Private Details (Admin Only)</p>
                    <input type="text" id="o-name" placeholder="Your Name" class="input-f" required>
                    <input type="tel" id="o-mob" placeholder="Mobile Number" class="input-f" required>
                    <textarea id="o-addr" placeholder="Full Address" class="input-f h-20" required></textarea>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <input type="text" id="o-loc" placeholder="Location (eg: Chennai)" class="input-f" required>
                    <select id="o-bhk" class="input-f"><option>1BHK</option><option>2BHK</option><option>3BHK</option></select>
                    <select id="o-htype" class="input-f" onchange="checkFloor(this.value)"><option>Seperate House</option><option>Apartment</option></select>
                    <input type="text" id="o-floor" placeholder="Floor No (If Apt)" class="input-f hidden">
                    <select id="o-eb" class="input-f"><option>Separated EB</option><option>Shared EB</option></select>
                    <select id="o-water" class="input-f"><option>Metro Water</option><option>Bore Water</option></select>
                    <select id="o-food" class="input-f"><option>Veg Only</option><option>Non-Veg Allowed</option></select>
                    <select id="o-pet" class="input-f"><option>Pet Allowed</option><option>Not Allowed</option></select>
                    <select id="o-mode" class="input-f"><option>Rent</option><option>Lease</option></select>
                    <select id="o-access" class="input-f"><option>Disabled Accessible: Yes</option><option>No</option></select>
                    <input type="text" id="o-size" placeholder="Size (sqft)" class="input-f">
                    <select id="o-toilet" class="input-f"><option>1 Toilet</option><option>2 Toilets</option><option>3 Toilets</option></select>
                    <select id="o-kids" class="input-f"><option>Kids/Aged Issue: No</option><option>Yes</option></select>
                    <select id="o-park" class="input-f"><option>Bike Parking</option><option>Car Parking</option><option>Both</option></select>
                    <select id="o-terrace" class="input-f"><option>Terrace Access: Yes</option><option>No</option></select>
                    <select id="o-adv" class="input-f"><option>3 Months Advance</option><option>4 Months</option><option>5 Months</option><option>Above 5</option></select>
                    <select id="o-agree" class="input-f"><option>Agreement: Yes</option><option>No</option></select>
                    <input type="number" id="o-rent" placeholder="Rent + Maint" class="input-f" required>
                </div>

                <div class="mt-4 p-4 border rounded-2xl">
                    <p class="text-[10px] font-black mb-2 uppercase text-emerald-600">Upload 5 House Photos</p>
                    <input type="file" id="o-files" multiple accept="image/*" class="text-xs font-bold" required>
                </div>
                
                <textarea id="o-cond" placeholder="Other Conditions (Private)" class="input-f h-20 mt-4"></textarea>
                <button type="submit" id="o-btn" class="w-full bg-emerald-600 text-white font-black py-4 rounded-2xl shadow-lg uppercase mt-4">Submit Listing</button>
            </form>
        </div>
    </div>

    <div id="partner" class="page p-4">
        <div class="max-w-md mx-auto bg-white p-6 rounded-3xl border shadow-sm">
            <h2 class="text-xl font-black italic mb-2">Partner Program</h2>
            <p class="text-[10px] text-red-500 font-bold mb-6">BGV செய்யப்படும். தவறான தகவல்களுக்கு சட்டப்படி நடவடிக்கை எடுக்கப்படும்.</p>
            <form id="partnerForm">
                <input type="file" id="p-selfie" class="text-xs mb-4" required>
                <input type="text" id="p-name" placeholder="Full Name (Aadhar)" class="input-f" required>
                <input type="text" id="p-fname" placeholder="Father Name" class="input-f" required>
                <input type="number" id="p-aadhar" placeholder="Aadhar No" class="input-f" required>
                <textarea id="p-addr" placeholder="Address" class="input-f h-20" required></textarea>
                <input type="text" id="p-exp" placeholder="Previous Experience" class="input-f">
                <p class="text-[9px] font-bold mt-2">Upload Aadhar/License Image</p>
                <input type="file" id="p-docs" class="text-xs mb-4" required>
                <button type="submit" id="p-btn" class="w-full bg-black text-white font-black py-4 rounded-2xl uppercase shadow-lg">Apply Partner</button>
            </form>
        </div>
    </div>

    <div id="service" class="page p-6 text-center">
        <h2 class="text-2xl font-black italic mb-8">Our Home Services</h2>
        <div class="grid grid-cols-2 gap-4">
            <div onclick="serviceSoon()" class="p-6 bg-white border rounded-3xl shadow-sm"><i class="fas fa-tools text-2xl mb-2 text-blue-500"></i><p class="text-[10px] font-black">Plumbing</p></div>
            <div onclick="serviceSoon()" class="p-6 bg-white border rounded-3xl shadow-sm"><i class="fas fa-bolt text-2xl mb-2 text-yellow-500"></i><p class="text-[10px] font-black">Electrical</p></div>
            <div onclick="serviceSoon()" class="p-6 bg-white border rounded-3xl shadow-sm"><i class="fas fa-paint-roller text-2xl mb-2 text-green-500"></i><p class="text-[10px] font-black">Painting</p></div>
            <div onclick="serviceSoon()" class="p-6 bg-white border rounded-3xl shadow-sm"><i class="fas fa-broom text-2xl mb-2 text-purple-500"></i><p class="text-[10px] font-black">Cleaning</p></div>
        </div>
    </div>

    <div id="help" class="page p-4">
        <div class="max-w-md mx-auto space-y-4">
            <div class="bg-emerald-600 text-white p-6 rounded-[30px] shadow-lg">
                <h3 class="font-black italic text-lg mb-2">Owner Posting: FREE</h3>
                <p class="text-xs opacity-90 leading-relaxed">Owners-க்கு எந்த கட்டணமும் இல்லை. இது ஒரு நேரடி தொடர்பு பாலம். / Free for owners, connecting you directly with tenants.</p>
            </div>
            <div class="bg-white border-2 border-emerald-500 p-6 rounded-[30px]">
                <h3 class="font-black italic text-emerald-600 text-lg mb-2">Subscription: ₹999</h3>
                <p class="text-xs leading-relaxed text-gray-500 font-bold">வீட்டை நேரில் பார்த்த பிறகு இந்த சந்தாவை செலுத்தினால் போதும். / Payable only after your physical visit to the house.</p>
            </div>
            <div class="flex gap-2">
                <a href="tel:916379548175" class="flex-1 bg-white border py-4 rounded-2xl text-center font-black text-xs uppercase shadow-sm">Call Support</a>
                <a href="https://wa.me/916379548175" class="flex-1 bg-green-500 text-white py-4 rounded-2xl text-center font-black text-xs uppercase shadow-sm">WhatsApp</a>
            </div>
            <p onclick="hTap()" class="text-center text-[10px] text-gray-300 font-bold tracking-widest pt-20">© 2026 FRENTLY.IN ONLINE PLATFORM</p>
        </div>
    </div>

    <div id="book-modal" class="fixed inset-0 bg-black/60 z-[2000] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-[40px] p-8">
            <h2 class="text-xl font-black italic mb-4">Confirm Booking</h2>
            <input type="text" id="b-name" placeholder="Your Name" class="input-f">
            <input type="tel" id="b-mob" placeholder="Mobile Number" class="input-f">
            <input type="text" id="b-loc" placeholder="Your Location" class="input-f">
            <button onclick="submitBooking()" class="w-full bg-emerald-600 text-white font-black py-4 rounded-2xl shadow-xl mt-2">SUBMIT BOOKING</button>
            <button onclick="closeModal()" class="w-full text-[10px] font-bold text-gray-400 mt-4">BACK</button>
        </div>
    </div>

    <div id="adm-panel" class="page p-4">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-black italic uppercase">Admin Control</h2>
            <button onclick="location.reload()" class="bg-red-50 text-red-600 px-4 py-1 rounded-full text-[10px] font-black">LOGOUT</button>
        </div>
        <div id="adm-list" class="space-y-4"></div>
    </div>

    <nav class="nav-fixed">
        <button onclick="showP('home')" id="btn-home" class="flex flex-col items-center text-emerald-600"><i class="fas fa-home"></i><span class="text-[9px] mt-1 font-black">HOME</span></button>
        <button onclick="showP('owner')" id="btn-owner" class="flex flex-col items-center text-gray-400"><i class="fas fa-plus-circle"></i><span class="text-[9px] mt-1 font-black">OWNER</span></button>
        <button onclick="showP('partner')" id="btn-partner" class="flex flex-col items-center text-gray-400"><i class="fas fa-user-friends"></i><span class="text-[9px] mt-1 font-black">PARTNER</span></button>
        <button onclick="showP('service')" id="btn-service" class="flex flex-col items-center text-gray-400"><i class="fas fa-tools"></i><span class="text-[9px] mt-1 font-black">SERVICE</span></button>
        <button onclick="showP('help')" id="btn-help" class="flex flex-col items-center text-gray-400"><i class="fas fa-headset"></i><span class="text-[9px] mt-1 font-black">HELP</span></button>
    </nav>

    <script>
        // FIREBASE INITIALIZATION
        const firebaseConfig = {
            apiKey: "AIzaSyCE8ifaUi81vhonXR7XVhQgTzfwc0v3t8w",
            authDomain: "frently-online.firebaseapp.com",
            projectId: "frently-online",
            storageBucket: "frently-online.firebasestorage.app",
            messagingSenderId: "895745691340",
            appId: "1:895745691340:web:2300e54c79257124e77c69"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // CLOUDINARY CONFIG
        const CLOUD_NAME = "de3sxncm2";
        const PRESET = "Frently-online"; // உங்களின் Unsigned Preset பெயர்

        let tap = 0;
        let selectedHouse = "";
        let allHouses = [];

        // NAVIGATION LOGIC
        function showP(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            document.querySelectorAll('nav button').forEach(b => b.classList.replace('text-emerald-600', 'text-gray-400'));
            if(id !== 'adm-panel') document.getElementById('btn-' + id).classList.replace('text-gray-400', 'text-emerald-600');
            
            if(id === 'home') fetchHome();
            window.scrollTo(0,0);
        }

        // ADMIN LOGIN LOGIC (Enhanced)
        function hTap() {
            tap++;
            if(tap === 7) {
                tap = 0;
                const user = prompt("Enter Admin User:");
                const pass = prompt("Enter Admin Pass:");
                if(user === "Sasineel1302" && pass === "Jaibhimbuddha1302") {
                    document.getElementById('adm-badge').classList.remove('hidden');
                    showP('adm-panel');
                    renderAdmin();
                } else { alert("Locked! Wrong credentials."); }
            }
            setTimeout(() => tap = 0, 5000);
        }

        function checkFloor(v) { document.getElementById('o-floor').classList.toggle('hidden', v !== 'Apartment'); }
        function serviceSoon() { alert("Coming soon in your area!"); }

        // IMAGE UPLOAD (Cloudinary)
        async function uploadImages(files) {
            let urls = [];
            for (let file of files) {
                const fd = new FormData();
                fd.append("file", file);
                fd.append("upload_preset", PRESET);
                const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, { method: "POST", body: fd });
                const d = await res.json();
                urls.push(d.secure_url);
            }
            return urls;
        }

        // OWNER FORM SUBMIT
        document.getElementById('ownerForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('o-btn');
            btn.disabled = true; btn.innerText = "UPLOADING DATA...";

            try {
                const files = document.getElementById('o-files').files;
                const imageUrls = await uploadImages(files);
                const id = "ONS-" + Math.floor(1000 + Math.random() * 9000);

                const data = {
                    id,
                    admin_data: {
                        name: document.getElementById('o-name').value,
                        mob: document.getElementById('o-mob').value,
                        addr: document.getElementById('o-addr').value,
                        cond: document.getElementById('o-cond').value
                    },
                    public_data: {
                        loc: document.getElementById('o-loc').value,
                        bhk: document.getElementById('o-bhk').value,
                        type: document.getElementById('o-htype').value,
                        floor: document.getElementById('o-floor').value || 'N/A',
                        eb: document.getElementById('o-eb').value,
                        water: document.getElementById('o-water').value,
                        food: document.getElementById('o-food').value,
                        pet: document.getElementById('o-pet').value,
                        mode: document.getElementById('o-mode').value,
                        access: document.getElementById('o-access').value,
                        size: document.getElementById('o-size').value,
                        toilet: document.getElementById('o-toilet').value,
                        kids: document.getElementById('o-kids').value,
                        park: document.getElementById('o-park').value,
                        terrace: document.getElementById('o-terrace').value,
                        adv: document.getElementById('o-adv').value,
                        agree: document.getElementById('o-agree').value,
                        rent: document.getElementById('o-rent').value,
                        images: imageUrls
                    },
                    status: 'pending',
                    time: new Date()
                };

                await db.collection("listings").doc(id).set(data);
                window.open(`https://wa.me/916379548175?text=${encodeURIComponent("New Listing ID: " + id + "\nName: " + data.admin_data.name)}`);
                alert("Success! Waiting for Admin Approval.");
                location.reload();
            } catch (err) { alert("Upload Failed. Check Internet/Cloudinary."); btn.disabled = false; }
        };

        // HOME LISTINGS & FILTERS
        async function fetchHome() {
            const grid = document.getElementById('main-grid');
            const snap = await db.collection("listings").where("status", "==", "approved").get();
            allHouses = snap.docs.map(doc => doc.data());
            
            // Auto-populate Location Filter
            const locS = document.getElementById('f-loc');
            const locs = [...new Set(allHouses.map(h => h.public_data.loc))];
            locS.innerHTML = '<option value="">Location</option>';
            locs.forEach(l => locS.innerHTML += `<option>${l}</option>`);

            renderHouses(allHouses);
        }

        function filterData() {
            const l = document.getElementById('f-loc').value;
            const b = document.getElementById('f-bhk').value;
            const e = document.getElementById('f-eb').value;
            const w = document.getElementById('f-water').value;
            const f = document.getElementById('f-food').value;
            const p = document.getElementById('f-pet').value;
            const m = document.getElementById('f-mode').value;

            const filtered = allHouses.filter(h => {
                const d = h.public_data;
                return (!l || d.loc === l) && (!b || d.bhk === b) && (!e || d.eb.includes(e)) &&
                       (!w || d.water.includes(w)) && (!f || d.food.includes(f)) &&
                       (!p || d.pet.includes(p)) && (!m || d.mode === m);
            });
            renderHouses(filtered);
        }

        function renderHouses(arr) {
            const grid = document.getElementById('main-grid');
            grid.innerHTML = arr.length ? '' : '<p class="text-center py-10 opacity-40">No houses found.</p>';
            arr.forEach(h => {
                const d = h.public_data;
                grid.innerHTML += `
                    <div class="bg-white rounded-[30px] overflow-hidden border shadow-sm">
                        <img src="${d.images[0]}" class="w-full h-56 object-cover bg-gray-100">
                        <div class="p-5">
                            <div class="flex justify-between items-start">
                                <div><h3 class="font-black text-sm uppercase">${d.loc}</h3><p class="text-[9px] font-bold text-gray-400">${d.bhk} • ${d.type} • Floor: ${d.floor}</p></div>
                                <p class="text-emerald-600 font-black text-lg">₹${d.rent}</p>
                            </div>
                            <div class="grid grid-cols-2 gap-y-1 mt-3 text-[8px] font-black uppercase opacity-60">
                                <span><i class="fas fa-bolt mr-1"></i> ${d.eb}</span>
                                <span><i class="fas fa-tint mr-1"></i> ${d.water}</span>
                                <span><i class="fas fa-car mr-1"></i> ${d.park}</span>
                                <span><i class="fas fa-paw mr-1"></i> ${d.pet}</span>
                            </div>
                            <button onclick="openBooking('${h.id}')" class="w-full bg-emerald-600 text-white py-3 rounded-2xl font-black mt-4 text-[10px] uppercase shadow-md">Book for Visit</button>
                        </div>
                    </div>`;
            });
        }

        // BOOKING LOGIC
        function openBooking(id) { selectedHouse = id; document.getElementById('book-modal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('book-modal').classList.add('hidden'); }
        
        async function submitBooking() {
            const n = document.getElementById('b-name').value;
            const m = document.getElementById('b-mob').value;
            const l = document.getElementById('b-loc').value;
            const cid = "CMS-" + Math.floor(100 + Math.random() * 900);
            const msg = `New Booking Request: ${cid}\nHouse: ${selectedHouse}\nName: ${n}\nMobile: ${m}\nLocation: ${l}`;
            window.open(`https://wa.me/916379548175?text=${encodeURIComponent(msg)}`);
            alert("Booking Notification Sent!");
            closeModal();
        }

        // ADMIN PANEL LOGIC
        async function renderAdmin() {
            const list = document.getElementById('adm-list');
            const snap = await db.collection("listings").orderBy("time", "desc").get();
            list.innerHTML = '';
            snap.forEach(doc => {
                const h = doc.data();
                list.innerHTML += `
                    <div class="bg-white p-4 rounded-3xl border-l-8 ${h.status==='approved'?'border-emerald-500':'border-orange-400'} shadow-sm">
                        <p class="text-[9px] font-bold opacity-30">${h.id} | ${h.time.toDate().toLocaleDateString()}</p>
                        <h4 class="font-black text-sm">${h.admin_data.name} (${h.admin_data.mob})</h4>
                        <p class="text-[10px] font-bold text-gray-400">${h.admin_data.addr}</p>
                        <div class="flex gap-2 overflow-x-auto py-3">
                            ${h.public_data.images.map(img => `<img src="${img}" class="h-14 w-14 rounded-xl object-cover border">`).join('')}
                        </div>
                        <div class="flex gap-2 mt-2">
                            ${h.status==='pending' ? `<button onclick="approveListing('${h.id}')" class="bg-emerald-600 text-white px-4 py-2 rounded-xl text-[10px] font-black uppercase">Approve</button>` : ''}
                            <button onclick="deleteListing('${h.id}')" class="bg-red-50 text-red-500 px-4 py-2 rounded-xl text-[10px] font-black uppercase">Delete</button>
                        </div>
                    </div>`;
            });
        }

        async function approveListing(id) { await db.collection("listings").doc(id).update({status: 'approved'}); renderAdmin(); }
        async function deleteListing(id) { if(confirm("Permanently Delete?")) { await db.collection("listings").doc(id).delete(); renderAdmin(); } }

        // PARTNER FORM
        document.getElementById('partnerForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('p-btn'); btn.disabled = true;
            const id = "PTN-" + Math.floor(100 + Math.random() * 900);
            const data = {
                id, name: document.getElementById('p-name').value, 
                aadhar: document.getElementById('p-aadhar').value,
                time: new Date()
            };
            await db.collection("partners").doc(id).set(data);
            window.open(`https://wa.me/916379548175?text=${encodeURIComponent("Partner Application: " + id + "\nName: " + data.name)}`);
            alert("Application Sent to WhatsApp!");
            location.reload();
        }

        window.onload = fetchHome;
    </script>
</body>
</html>
